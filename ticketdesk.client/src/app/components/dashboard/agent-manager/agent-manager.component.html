<div class="container mt-4">
  <h2>Agent Manager</h2>
  <button pButton type="button" label="Create Agent" icon="pi pi-plus" (click)="showDialog()" class="mb-2"></button>

  <p-table [value]="agents" [paginator]="true" [rows]="rows" [totalRecords]="totalRecords" [lazy]="false" [first]="first" (onPage)="onPage($event)">
    <ng-template pTemplate="header">
      <tr>
        <th>First Name</th>
        <th>Last Name</th>
        <th>Phone Number</th>
        <th>Email Address</th>
        <th>Role ID</th>
        <th>Actions</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-agent>
      <tr>
        <td>{{ agent.user.firstName }}</td>
        <td>{{ agent.user.lastName }}</td>
        <td>{{ agent.user.phoneNumber }}</td>
        <td>{{ agent.user.emailAddress }}</td>
        <td>{{ agent.user.roleId }}</td>
        <td>
          <button pButton type="button" icon="pi pi-pencil" class="p-button-warning mr-2" (click)="editAgent(agent.agentId)"></button>
          <button pButton type="button" icon="pi pi-trash" class="p-button-danger" (click)="confirmDelete(agent.agentId)"></button>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <!-- Dialog for creating and updating agents -->
  <p-dialog header="{{ isEditMode ? 'Update Agent' : 'Create Agent' }}" [(visible)]="displayDialog" [modal]="true" [style]="{ width: '500px' }">
    <form [formGroup]="agentForm" (ngSubmit)="onSubmit()">
      <div class="form-group">
        <label for="firstName">First Name</label>
        <input type="text" pInputText formControlName="firstName" class="form-control" id="firstName" required [ngClass]="{ 'is-invalid': submitted && f['firstName'].errors }">
        <div *ngIf="submitted && f['firstName'].errors" class="invalid-feedback">
          <div *ngIf="f['firstName'].errors['required']">First Name is required</div>
        </div>
      </div>
      <div class="form-group">
        <label for="lastName">Last Name</label>
        <input type="text" pInputText formControlName="lastName" class="form-control" id="lastName" required [ngClass]="{ 'is-invalid': submitted && f['lastName'].errors }">
        <div *ngIf="submitted && f['lastName'].errors" class="invalid-feedback">
          <div *ngIf="f['lastName'].errors['required']">Last Name is required</div>
        </div>
      </div>
      <div class="form-group">
        <label for="phoneNumber">Phone Number</label>
        <input type="text" pInputText formControlName="phoneNumber" class="form-control" id="phoneNumber" required [ngClass]="{ 'is-invalid': submitted && f['phoneNumber'].errors }">
        <div *ngIf="submitted && f['phoneNumber'].errors" class="invalid-feedback">
          <div *ngIf="f['phoneNumber'].errors['required']">Phone Number is required</div>
        </div>
      </div>
      <div class="form-group">
        <label for="emailAddress">Email Address</label>
        <input type="email" pInputText formControlName="emailAddress" class="form-control" id="emailAddress" required [ngClass]="{ 'is-invalid': submitted && f['emailAddress'].errors }">
        <div *ngIf="submitted && f['emailAddress'].errors" class="invalid-feedback">
          <div *ngIf="f['emailAddress'].errors['required']">Email Address is required</div>
          <div *ngIf="f['emailAddress'].errors['email']">Email Address is invalid</div>
        </div>
      </div>
      <div class="form-group">
        <label for="password">Password</label>
        <input type="password" pInputText formControlName="password" class="form-control" id="password" required [ngClass]="{ 'is-invalid': submitted && f['password'].errors }">
        <div *ngIf="submitted && f['password'].errors" class="invalid-feedback">
          <div *ngIf="f['password'].errors['required']">Password is required</div>
        </div>
      </div>
      <div class="p-dialog-footer">
        <button pButton type="submit" label="{{ isEditMode ? 'Update' : 'Create' }}" class="p-button-primary"></button>
      </div>
    </form>
  </p-dialog>

  <p-confirmDialog></p-confirmDialog>
</div>
